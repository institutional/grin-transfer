# Docker Compose configuration for Cloudflare R2 storage
# 
# Usage:
#   1. Copy this file to your project root
#   2. Create the credentials file: examples/docker/r2-credentials.json
#   3. Run: docker-compose -f docker-compose.r2.yml up -d
#
# This configuration mounts R2 credentials and configures the application
# to use Cloudflare R2 for storage.

services:
  grin-to-s3:
    build: .
    container_name: grin-to-s3-r2
    restart: unless-stopped
    
    volumes:
      # Application data
      - ./docker-data/data:/app/data
      - ./docker-data/output:/app/output
      - ./docker-data/config:/app/config
      - ./docker-data/logs:/app/logs
      - ./docker-data/staging:/app/staging
      
      # R2 credentials
      - ./examples/docker/r2-credentials.json:/app/config/r2-credentials.json:ro
      
      # OAuth2 credentials (create these from GRIN setup)
      - ./examples/docker/client_secret.json:/app/config/client_secret.json:ro
      - ./examples/docker/credentials.json:/app/config/credentials.json:ro
      
      # Optional: GPG key for decryption
      # - ./examples/docker/gpg-key.asc:/app/config/gpg-key.asc:ro
    
    environment:
      # Application configuration
      - GRIN_CONFIG_DIR=/app/config
      - GRIN_DATA_DIR=/app/data
      - GRIN_OUTPUT_DIR=/app/output
      - GRIN_LOG_DIR=/app/logs
      - GRIN_STAGING_DIR=/app/staging
      
      # R2 configuration
      - GRIN_STORAGE_TYPE=r2
      - GRIN_BUCKET_RAW=your-raw-bucket
      - GRIN_BUCKET_META=your-meta-bucket
      - GRIN_BUCKET_FULL=your-full-bucket
      
      # R2 credentials (loaded from file)
      - R2_CREDENTIALS_FILE=/app/config/r2-credentials.json
      
      # GRIN API settings
      - GRIN_RATE_LIMIT=5.0
    
    networks:
      - grin-network
    
    command: ["--help"]

volumes:
  grin-data:
  grin-output:
  grin-config:
  grin-logs:
  grin-staging:

networks:
  grin-network:
    driver: bridge