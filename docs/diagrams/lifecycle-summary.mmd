%%{init: {"theme": "base", "themeVariables": {"primaryTextColor": "#1e293b", "primaryBorderColor": "#475569", "lineColor": "#64748b", "background": "transparent", "mainBkg": "transparent", "secondBkg": "transparent"}, "flowchart": {"defaultRenderer": "elk", "elk": {"elk.direction": "RIGHT"}}}}%%
flowchart LR
    Start([Kick off run<br/>via grin CLI]):::terminal --> Collect[Harvest GRIN volume metadata<br/>into run database]:::process
    Collect --> Download{File package available<br/>for download?}:::decision
    Download -->|no| Convert[Request conversion and wait<br/>for file package availability]:::process
    Convert --> Download
    Download -->|yes| Retrieve[Retrieve file package and decrypt<br/>for staging]:::process
    Retrieve --> Publish[Publish normalized artifacts<br/>to storage buckets]:::process
    Publish --> Meta[(Metadata<br/>bucket)]:::storage
    Publish --> Raw[(Raw file package<br/>bucket)]:::storage
    Publish --> Full[(Full fidelity<br/>bucket)]:::storage
    Meta --> Complete([Artifacts ready<br/>for downstream use]):::terminal
    Raw --> Complete
    Full --> Complete

    classDef terminal fill:none,stroke:#6b7280,stroke-width:3px,color:#374151
    classDef process fill:none,stroke:#3b82f6,stroke-width:3px,color:#1e40af
    classDef storage fill:none,stroke:#10b981,stroke-width:3px,color:#047857
    classDef decision fill:none,stroke:#f97316,stroke-width:3px,color:#7c2d12
